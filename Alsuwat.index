<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Driver Loading Entry</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #e3f2fd);
      margin: 0;
      padding: 20px;
    }

    .truck-container {
      width: 100%;
      overflow: hidden;
      position: relative;
      height: 120px;
      margin-bottom: 20px;
    }

    .truck {
      position: absolute;
      left: -200px;
      bottom: 0;
      animation: moveTruck 6s linear infinite;
    }

    @keyframes moveTruck {
      0% { left: -200px; }
      100% { left: 100%; }
    }

    h2 {
      text-align: center;
      color: #0d47a1;
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    p {
      text-align: center;
      color: #555;
      font-size: 14px;
      margin-bottom: 20px;
    }

    form {
      background-color: #fff;
      border-radius: 16px;
      padding: 25px;
      max-width: 800px;
      margin: 0 auto;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }

    label {
      font-weight: 600;
      color: #333;
      margin-top: 10px;
      display: block;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    input:focus, textarea:focus {
      border-color: #2196f3;
      box-shadow: 0 0 5px rgba(33,150,243,0.3);
      outline: none;
    }

    #packageInputs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .pkg-box {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .pkg-box input {
      width: 160px;
    }

    .pkg-box button {
      background: #ef5350;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      padding: 6px 8px;
    }

    .pkg-box button:hover {
      background: #d32f2f;
    }

    .add-btn {
      background: #43a047;
      color: white;
      padding: 8px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      font-weight: 600;
    }

    .add-btn:hover {
      background: #2e7d32;
    }

    .preview-btn {
      background: #1976d2;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      margin-top: 20px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      width: 100%;
    }

    .preview-btn:hover {
      background: #0d47a1;
    }

    /* Preview Modal */
    #previewModal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    #previewBox {
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      animation: popUp 0.3s ease;
    }

    @keyframes popUp {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    th {
      background: #e3f2fd;
      color: #0d47a1;
    }

    .closeBtn {
      float: right;
      background: #ef5350;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 5px 10px;
      cursor: pointer;
      font-weight: 600;
    }

    .closeBtn:hover {
      background: #c62828;
    }
  </style>
</head>
<body>

  <div class="truck-container">
    <img src="https://cdn-icons-png.flaticon.com/512/2784/2784463.png" class="truck" width="150" alt="Truck">
  </div>

  <h2>Driver Loading Entry</h2>
  <p>Please fill all details carefully before submitting</p>

  <form id="driverForm">
    <label>Driver Name</label>
    <input type="text" name="driver_name" required>

    <label>Truck No</label>
    <input type="text" name="truck_no" required>

    <label>Contact No</label>
    <input type="text" name="contact_no" required>

    <label>Package Nos</label>
    <div id="packageInputs">
      <div class="pkg-box">
        <input type="text" name="package_no[]" placeholder="Enter Package No" required>
      </div>
    </div>
    <button type="button" class="add-btn" onclick="addPackage()">+ Add Package</button>

    <label>Port Name</label>
    <input type="text" name="port_name">

    <label>Loading Location</label>
    <input type="text" name="loading_location">

    <label>Loading Date</label>
    <input type="date" name="loading_date" id="loading_date" required>

    <label>Offloading Location</label>
    <input type="text" name="offloading_location">

    <label>Offloading Date</label>
    <input type="date" name="offloading_date">

    <label>Remarks</label>
    <textarea name="remarks" rows="2" placeholder="Any notes..."></textarea>

    <button type="button" class="preview-btn" onclick="showPreview()">Preview</button>
  </form>

  <!-- Preview Modal -->
  <div id="previewModal">
    <div id="previewBox">
      <button class="closeBtn" onclick="closePreview()">X</button>
      <h3 style="text-align:center;">Preview Entry</h3>
      <table id="previewTable"></table>
      <div style="text-align:center; margin-top:15px;">
        <button class="add-btn" onclick="submitForm()">✅ Confirm & Submit</button>
      </div>
    </div>
  </div>

  <script>
    document.getElementById("loading_date").valueAsDate = new Date();

    function addPackage() {
      const pkgContainer = document.getElementById("packageInputs");
      const div = document.createElement("div");
      div.className = "pkg-box";
      div.innerHTML = `
        <input type="text" name="package_no[]" placeholder="Enter Package No" required>
        <button type="button" onclick="removePackage(this)">X</button>
      `;
      pkgContainer.appendChild(div);
    }

    function removePackage(btn) {
      btn.parentElement.remove();
    }

    function showPreview() {
      const form = document.getElementById("driverForm");
      const data = new FormData(form);

      let html = `
        <tr><th>Field</th><th>Value</th></tr>
        <tr><td>Driver Name</td><td>${data.get("driver_name")}</td></tr>
        <tr><td>Truck No</td><td>${data.get("truck_no")}</td></tr>
        <tr><td>Contact No</td><td>${data.get("contact_no")}</td></tr>
        <tr><td>Port Name</td><td>${data.get("port_name")}</td></tr>
        <tr><td>Loading Location</td><td>${data.get("loading_location")}</td></tr>
        <tr><td>Loading Date</td><td>${data.get("loading_date")}</td></tr>
        <tr><td>Offloading Location</td><td>${data.get("offloading_location")}</td></tr>
        <tr><td>Offloading Date</td><td>${data.get("offloading_date")}</td></tr>
        <tr><td>Remarks</td><td>${data.get("remarks")}</td></tr>
        <tr><td>Package Nos</td><td>`;

      const pkgs = data.getAll("package_no[]");
      html += pkgs.join(", ");
      html += `</td></tr>`;

      document.getElementById("previewTable").innerHTML = html;
      document.getElementById("previewModal").style.display = "flex";
    }

    function closePreview() {
      document.getElementById("previewModal").style.display = "none";
    }

    function submitForm() {
      const form = document.getElementById("driverForm");
      const formData = new FormData(form);
      const data = {};
      formData.forEach((value, key) => {
        if (key.endsWith("[]")) {
          const realKey = key.replace("[]", "");
          if (!data[realKey]) data[realKey] = [];
          data[realKey].push(value);
        } else {
          data[key] = value;
        }
      });

      fetch("REPLACE_WITH_YOUR_GOOGLE_SCRIPT_URL", {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      alert("✅ Entry submitted successfully!");
      document.getElementById("previewModal").style.display = "none";
      form.reset();
      document.getElementById("loading_date").valueAsDate = new Date();
      document.getElementById("packageInputs").innerHTML =
        '<div class="pkg-box"><input type="text" name="package_no[]" placeholder="Enter Package No" required></div>';
    }
  </script>
</body>
</html>
